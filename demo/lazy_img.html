<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>图片懒加载</title>
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        .image-box{
            display: flex;
            flex-wrap: wrap;
        }
        .image-box img{
            width: 33.33%;
            padding: 10px;
        }
        h1{
            text-align: center;
            font-size: 40px;
        }
    </style>
</head>
<body>
    <h1>图片懒加载</h1>
    <div class="image-box">
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/10/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/11/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/12/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/13/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/14/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/15/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/16/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/17/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/18/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/19/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/20/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/21/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/22/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/23/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/24/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/25/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/26/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/27/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/28/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/29/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/30/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/31/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/32/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/33/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/34/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/35/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/36/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/37/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/38/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/39/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/40/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/41/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/42/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/43/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/44/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/45/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/46/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/47/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/48/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/49/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/50/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/51/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/52/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/53/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/54/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/55/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/56/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/57/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/58/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/59/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/60/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/61/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/62/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/63/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/64/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/65/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/66/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/67/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/68/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/69/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/70/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/71/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/72/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/73/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/74/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/75/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/76/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/77/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/78/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/79/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/80/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/81/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/82/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/83/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/84/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/85/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/1/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/87/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/88/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/89/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/90/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/91/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/92/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/93/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/94/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/95/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/96/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/2/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/98/300/300.jpg" alt="image"/>
        <img src="../image/placeholder.webp" class="lazy" data-src="https://i.picsum.photos/id/99/300/300.jpg" alt="image"/>
    </div>
    <script src="../js/jquery-1.11.0.min.js"></script>
    <script src="../js/index.js"></script>
    <script>
        function isInViewport(el) {
            const inBelow = el.getBoundingClientRect().top > window.innerHeight   // 元素在屏幕下方的情况
            const inAbove = el.getBoundingClientRect().bottom < 0           // 元素在屏幕上方的情况
            const visible = getComputedStyle(el).display !== "none"           // 元素display样式为none
            return !inBelow && !inAbove  && visible
        }

        var lazyLoad = (function(){
            var isActive = false;// 节流，每200s触发一次
            return function () {
                if(isActive){ return }
                isActive = true
                setTimeout(function(){
                    //转换成数组
                    var lazyImgs =  [].slice.call(document.querySelectorAll('img.lazy'));
                    lazyImgs.forEach(function (img) {
                        if(isInViewport(img)){
                            img.src = img.getAttribute('data-src');
                            img.classList.remove("lazy"); //移除已经加载好的
                        }
                    })
                    isActive = false
                }, 200)
            }
        })();

        document.addEventListener('DOMContentLoaded', function () {
            lazyLoad(); //第一次加载首屏
            window.addEventListener('scroll', lazyLoad);
            window.addEventListener('resize', lazyLoad);
            window.addEventListener('orientationchange', lazyLoad)//屏幕旋转事件
        })
    </script>
</body>
</html>